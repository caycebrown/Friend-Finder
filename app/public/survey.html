<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <title>Survey</title>
</head>
<body>
    <div class="container-fluid">
        <div class="jumbotron jumbotron-fluid"><h1 class="text-center">Personality Survey</h1></div>
        <div class="row">
            <div class="col-3"></div>
            <div class="col-6">
                
                
                <label>Name (Required)</label>
                <input id="name"></input>
                </br>
                <label>Image URL (Required)</label>
                <input id="image"></input>
                
                <p class="h6">Question 1</p>
                <div class="form-group">
                        <label for="q1">question/statement</label>
                        <select class="form-control" id="q1">
                        <option value="1">Strongly Disagree</option>
                        <option value="2">Somewhat Disagree</option>
                        <option value="3">Nuetral</option>
                        <option value="4">Somewhat Agree</option>
                        <option value="5">Strongly Agree</option>
                        </select>
                </div>
                <p class="h6">Question 2</p>
                <div class="form-group">
                        <label for="q2">question/statement</label>
                        <select class="form-control" id="q2">
                        <option value="1">Strongly Disagree</option>
                        <option value="2">Somewhat Disagree</option>
                        <option value="3">Nuetral</option>
                        <option value="4">Somewhat Agree</option>
                        <option value="5">Strongly Agree</option>
                        </select>
                </div>
                <p class="h6">Question 3</p>
                <div class="form-group">
                        <label for="q3">question/statement</label>
                        <select class="form-control" id="q3">
                        <option value="1">Strongly Disagree</option>
                        <option value="2">Somewhat Disagree</option>
                        <option value="3">Nuetral</option>
                        <option value="4">Somewhat Agree</option>
                        <option value="5">Strongly Agree</option>
                        </select>
                </div>
                <p class="h6">Question 4</p>
                <div class="form-group">
                        <label for="q4">question/statement</label>
                        <select class="form-control" id="q4">
                        <option value="1">Strongly Disagree</option>
                        <option value="2">Somewhat Disagree</option>
                        <option value="3">Nuetral</option>
                        <option value="4">Somewhat Agree</option>
                        <option value="5">Strongly Agree</option>
                        </select>
                </div>
                <p class="h6">Question 5</p>
                <div class="form-group">
                        <label for="q5">question/statement</label>
                        <select class="form-control" id="q5">
                        <option value="1">Strongly Disagree</option>
                        <option value="2">Somewhat Disagree</option>
                        <option value="3">Nuetral</option>
                        <option value="4">Somewhat Agree</option>
                        <option value="5">Strongly Agree</option>
                        </select>
                </div>
                <p class="h6">Question 6</p>
                <div class="form-group">
                        <label for="q6">question/statement</label>
                        <select class="form-control" id="q6">
                        <option value="1">Strongly Disagree</option>
                        <option value="2">Somewhat Disagree</option>
                        <option value="3">Nuetral</option>
                        <option value="4">Somewhat Agree</option>
                        <option value="5">Strongly Agree</option>
                        </select>
                </div>
                <p class="h6">Question 7</p>
                <div class="form-group">
                        <label for="q7">question/statement</label>
                        <select class="form-control" id="q7">
                        <option value="1">Strongly Disagree</option>
                        <option value="2">Somewhat Disagree</option>
                        <option value="3">Nuetral</option>
                        <option value="4">Somewhat Agree</option>
                        <option value="5">Strongly Agree</option>
                        </select>
                </div>
                <p class="h6">Question 8</p>
                <div class="form-group">
                        <label for="q8">question/statement</label>
                        <select class="form-control" id="q8">
                        <option value="1">Strongly Disagree</option>
                        <option value="2">Somewhat Disagree</option>
                        <option value="3">Nuetral</option>
                        <option value="4">Somewhat Agree</option>
                        <option value="5">Strongly Agree</option>
                        </select>
                </div>
                <p class="h6">Question 9</p>
                <div class="form-group">
                        <label for="q9">question/statement</label>
                        <select class="form-control" id="q9">
                        <option value="1">Strongly Disagree</option>
                        <option value="2">Somewhat Disagree</option>
                        <option value="3">Nuetral</option>
                        <option value="4">Somewhat Agree</option>
                        <option value="5">Strongly Agree</option>
                        </select>
                </div>
                <p class="h6">Question 10</p>
                <div class="form-group">
                        <label for="q10">question/statement</label>
                        <select class="form-control" id="q10">
                        <option value="1">Strongly Disagree</option>
                        <option value="2">Somewhat Disagree</option>
                        <option value="3">Nuetral</option>
                        <option value="4">Somewhat Agree</option>
                        <option value="5">Strongly Agree</option>
                        </select>
                </div>
                <button id="submit" class="btn btn-primary btn-lrg">Submit Survey</button>
            </div>
            <div class="col-3"></div>
        </div>
    </div>
    

    <script>

    var lowDiff = 41; //One number higher than maximum survey response difference
    var x = 0;

    function compareScores(arr1, arr2, index){
        console.log('i am running');
        var counter = 0;
        x++;
        for (i = 0; i <= 9; i++){
            
            diff = arr1[i] - arr2[i];
            console.log('diff: ' + diff);
 
            counter = counter + Math.abs(diff);
            console.log('counter: ' + counter);
        }
        if (lowDiff > counter){
            
            lowDiff = counter;
            console.log('lowdiff change:' + lowDiff);
            
            matchIndex = index;
            console.log('match index:' + matchIndex);
        };
    };

    $('#submit').on('click', function(){
        
        var user = {};

        user.name = $('#name').val();
        user.img = $('#image').val();
        user.scores = [
            $('#q1').val(),
            $('#q2').val(),
            $('#q3').val(),
            $('#q4').val(),
            $('#q5').val(),
            $('#q6').val(),
            $('#q7').val(),
            $('#q8').val(),
            $('#q9').val(),
            $('#q10').val(),
        ];

        $.post("/api/data", user)
        .then(function(user){
            console.log('sent data succesfully');
            $.get("api/data")
            .then(function(data){
                console.log('user: ' + user);//user still exits within scope here

                for (let i = 0; i < (data.users.length -1); i++){
                    compareScores(user.scores, data.users[i].scores, i)
                    console.log('data loop i: ' + i);
                }

                lowDiff = 41;
                x = 0;

                match = {name: data.users[matchIndex].name, image: data.users[matchIndex].img};
                console.log(match);

                
            });
            
        });
    });
    </script>

</body>
</html>
